<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Allva.Desktop.ViewModels.Admin"
             xmlns:m="using:Allva.Desktop.Models.Admin"
             x:Class="Allva.Desktop.Views.Admin.ManageComerciosView"
             x:DataType="vm:ManageComerciosViewModel">

    <Design.DataContext>
        <vm:ManageComerciosViewModel />
    </Design.DataContext>

    <!-- ============================================ -->
    <!-- GESTIÃ“N DE COMERCIOS - PANEL COMPLETO -->
    <!-- DiseÃ±o adaptado al estilo Allva -->
    <!-- ACTUALIZADO: Permisos por Local + UI mejorada -->
    <!-- CORREGIDO: Sin ColumnSpacing/RowSpacing ni ObjectConverters -->
    <!-- ============================================ -->

    <Grid RowDefinitions="Auto,*">
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- BARRA SUPERIOR CON ESTADÃSTICAS Y BOTÃ“N -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="0" 
                Background="#0b5394" 
                Padding="20,15"
                Margin="0,0,0,15">
            <Grid ColumnDefinitions="*,Auto">
                
                <!-- EstadÃ­sticas -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="30">
                    
                    <!-- Total Comercios -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="Total Comercios" 
                                   FontSize="11" 
                                   Foreground="#e0e0e0"/>
                        <TextBlock Text="{Binding TotalComercios}" 
                                   FontSize="22" 
                                   FontWeight="Bold" 
                                   Foreground="White"/>
                    </StackPanel>
                    
                    <!-- Activos -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="Activos" 
                                   FontSize="11" 
                                   Foreground="#e0e0e0"/>
                        <TextBlock Text="{Binding ComerciosActivos}" 
                                   FontSize="22" 
                                   FontWeight="Bold" 
                                   Foreground="#28a745"/>
                    </StackPanel>
                    
                    <!-- Inactivos -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="Inactivos" 
                                   FontSize="11" 
                                   Foreground="#e0e0e0"/>
                        <TextBlock Text="{Binding ComerciosInactivos}" 
                                   FontSize="22" 
                                   FontWeight="Bold" 
                                   Foreground="#dc3545"/>
                    </StackPanel>
                    
                    <!-- Total Locales -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="Total Locales" 
                                   FontSize="11" 
                                   Foreground="#e0e0e0"/>
                        <TextBlock Text="{Binding TotalLocales}" 
                                   FontSize="22" 
                                   FontWeight="Bold" 
                                   Foreground="#ffd966"/>
                    </StackPanel>
                    
                </StackPanel>
                
                <!-- BotÃ³n Nuevo Comercio -->
                <Button Grid.Column="1"
                        Command="{Binding MostrarFormularioCreacionCommand}"
                        Background="#ffd966"
                        Foreground="#0b5394"
                        Padding="20,10"
                        CornerRadius="8"
                        FontSize="14"
                        FontWeight="Bold"
                        Cursor="Hand">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="âž•" FontSize="16"/>
                        <TextBlock Text="Nuevo Comercio"/>
                    </StackPanel>
                </Button>
                
            </Grid>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- CONTENIDO PRINCIPAL CON SCROLL -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      Padding="0,0,15,0">
            
            <StackPanel Spacing="20" Margin="0,0,0,20">

                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- MENSAJE DE Ã‰XITO CON ANIMACIÃ“N -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <Border IsVisible="{Binding MostrarMensajeExito}"
                        Background="#d4edda"
                        BorderBrush="#c3e6cb"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="15"
                        Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock Text="âœ“" 
                                   FontSize="20" 
                                   FontWeight="Bold" 
                                   Foreground="#28a745" 
                                   VerticalAlignment="Center"/>
                        <StackPanel Spacing="4" VerticalAlignment="Center">
                            <TextBlock Text="{Binding MensajeExito}" 
                                       Foreground="#155724" 
                                       FontWeight="SemiBold"
                                       FontSize="14"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="El formulario se cerrarÃ¡ automÃ¡ticamente" 
                                       Foreground="#155724" 
                                       FontSize="11"
                                       Opacity="0.8"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- FORMULARIO DE CREACIÃ“N/EDICIÃ“N -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <Border IsVisible="{Binding MostrarFormulario}"
                        Background="White"
                        CornerRadius="8"
                        Padding="25"
                        BoxShadow="0 2 10 0 #15000000">
                    
                    <StackPanel Spacing="20">
                        
                        <!-- Header del formulario -->
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0"
                                       Text="{Binding TituloFormulario}" 
                                       FontSize="20" 
                                       FontWeight="Bold" 
                                       Foreground="#0b5394"/>
                            
                            <Button Grid.Column="1"
                                    Command="{Binding CancelarFormularioCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Content="âœ•"
                                    FontSize="20"
                                    Foreground="#666"
                                    Padding="8"
                                    Cursor="Hand"
                                    ToolTip.Tip="Cerrar formulario"/>
                        </Grid>

                        <Separator Background="#e0e0e0" Height="1"/>

                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <!-- DATOS BÃSICOS DEL COMERCIO -->
                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <StackPanel Spacing="18">
                            
                            <TextBlock Text="Datos BÃ¡sicos" 
                                       FontSize="16" 
                                       FontWeight="SemiBold" 
                                       Foreground="#0b5394"/>

                            <Grid ColumnDefinitions="*,15,*" RowDefinitions="Auto,15,Auto,15,Auto,15,Auto">
                                
                                <!-- Nombre Comercial -->
                                <StackPanel Grid.Column="0" Grid.Row="0" Spacing="6">
                                    <TextBlock Text="Nombre Comercial *" FontSize="13" Foreground="#555"/>
                                    <TextBox Text="{Binding NombreComercio}" 
                                             Watermark="Ej: Allva Travel"
                                             FontSize="14"/>
                                </StackPanel>

                                <!-- RazÃ³n Social -->
                                <StackPanel Grid.Column="2" Grid.Row="0" Spacing="6">
                                    <TextBlock Text="RazÃ³n Social / Nombre SRL *" FontSize="13" Foreground="#555"/>
                                    <TextBox Text="{Binding NombreSrl}" 
                                             Watermark="Ej: Allva Travel S.R.L."
                                             FontSize="14"/>
                                </StackPanel>

                                <!-- PaÃ­s -->
                                <StackPanel Grid.Column="0" Grid.Row="2" Spacing="6">
                                    <TextBlock Text="PaÃ­s *" FontSize="13" Foreground="#555"/>
                                    <TextBox Text="{Binding Pais}" 
                                             Watermark="Ej: Argentina"
                                             FontSize="14"/>
                                </StackPanel>

                                <!-- DirecciÃ³n Central -->
                                <StackPanel Grid.Column="2" Grid.Row="2" Spacing="6">
                                    <TextBlock Text="DirecciÃ³n Central" FontSize="13" Foreground="#555"/>
                                    <TextBox Text="{Binding DireccionCentral}" 
                                             Watermark="Ej: Av. Principal 123"
                                             FontSize="14"/>
                                </StackPanel>

                                <!-- Email -->
                                <StackPanel Grid.Column="0" Grid.Row="4" Spacing="6">
                                    <TextBlock Text="Email de Contacto *" FontSize="13" Foreground="#555"/>
                                    <TextBox Text="{Binding MailContacto}" 
                                             Watermark="contacto@empresa.com"
                                             FontSize="14"/>
                                </StackPanel>

                                <!-- TelÃ©fono -->
                                <StackPanel Grid.Column="2" Grid.Row="4" Spacing="6">
                                    <TextBlock Text="NÃºmero de Contacto" FontSize="13" Foreground="#555"/>
                                    <TextBox Text="{Binding NumeroContacto}" 
                                             Watermark="+54 9 11 1234-5678"
                                             FontSize="14"/>
                                </StackPanel>

                                <!-- Observaciones (ocupa 2 columnas) -->
                                <StackPanel Grid.Column="0" Grid.Row="6" Grid.ColumnSpan="3" Spacing="6">
                                    <TextBlock Text="Observaciones" FontSize="13" Foreground="#555"/>
                                    <TextBox Text="{Binding Observaciones}" 
                                             Watermark="InformaciÃ³n adicional..."
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"
                                             MinHeight="80"
                                             FontSize="14"/>
                                </StackPanel>

                            </Grid>

                        </StackPanel>

                        <Separator Background="#e0e0e0" Height="1"/>

                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <!-- CONFIGURACIÃ“N DE DIVISAS (solo si tiene mÃ³dulo) -->
                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <StackPanel Spacing="12">
                            
                            <TextBlock Text="ConfiguraciÃ³n de ComisiÃ³n de Divisas" 
                                       FontSize="16" 
                                       FontWeight="SemiBold" 
                                       Foreground="#0b5394"/>

                            <TextBlock Text="Este porcentaje aplica Ãºnicamente si algÃºn local tiene habilitado el mÃ³dulo de Divisas" 
                                       FontSize="12" 
                                       Foreground="#777"
                                       TextWrapping="Wrap"/>

                            <StackPanel Spacing="6">
                                <TextBlock Text="Porcentaje de ComisiÃ³n (%)" 
                                           FontSize="13" 
                                           Foreground="#555"/>
                                <NumericUpDown Value="{Binding PorcentajeComisionDivisas}"
                                               Minimum="0"
                                               Maximum="100"
                                               Increment="0.1"
                                               FormatString="F2"
                                               Width="200"
                                               HorizontalAlignment="Left"/>
                                <TextBlock Text="ComisiÃ³n que cobra el dueÃ±o de la aplicaciÃ³n por cada transacciÃ³n de divisas" 
                                           FontSize="11" 
                                           Foreground="#999"
                                           TextWrapping="Wrap"/>
                            </StackPanel>

                        </StackPanel>

                        <Separator Background="#e0e0e0" Height="1"/>

                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <!-- GESTIÃ“N DE LOCALES -->
                        <!-- AHORA CON PERMISOS DE MÃ“DULOS POR LOCAL -->
                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                        <StackPanel Spacing="12">
                            
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0"
                                           Text="Locales del Comercio" 
                                           FontSize="16" 
                                           FontWeight="SemiBold" 
                                           Foreground="#0b5394"/>
                                
                                <Button Grid.Column="1"
                                        Command="{Binding AgregarLocalCommand}"
                                        Background="#0b5394"
                                        Foreground="White"
                                        Padding="12,6"
                                        CornerRadius="6"
                                        FontSize="12"
                                        Cursor="Hand">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="+" FontSize="14" FontWeight="Bold"/>
                                        <TextBlock Text="Agregar Local"/>
                                    </StackPanel>
                                </Button>
                            </Grid>

                            <TextBlock Text="Configure cada local individualmente con sus permisos de mÃ³dulos" 
                                       FontSize="12" 
                                       Foreground="#777"/>

                            <!-- Lista de locales -->
                            <ItemsControl ItemsSource="{Binding Locales}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="vm:LocalFormModel">
                                        
                                        <Border Background="#f8f9fa"
                                                BorderBrush="#d0d0d0"
                                                BorderThickness="1"
                                                CornerRadius="8"
                                                Padding="20"
                                                Margin="0,0,0,12">
                                            
                                            <StackPanel Spacing="15">
                                                
                                                <!-- Header del local con botÃ³n eliminar -->
                                                <Grid ColumnDefinitions="*,Auto">
                                                    <TextBlock Grid.Column="0"
                                                               Text="InformaciÃ³n del Local" 
                                                               FontSize="14" 
                                                               FontWeight="SemiBold" 
                                                               Foreground="#0b5394"/>
                                                    
                                                    <Button Grid.Column="1"
                                                            Command="{Binding $parent[ItemsControl].((vm:ManageComerciosViewModel)DataContext).EliminarLocalCommand}"
                                                            CommandParameter="{Binding}"
                                                            Background="#dc3545"
                                                            Foreground="White"
                                                            Padding="10,4"
                                                            CornerRadius="4"
                                                            FontSize="11"
                                                            Cursor="Hand">
                                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                                            <TextBlock Text="ðŸ—‘ï¸" FontSize="12"/>
                                                            <TextBlock Text="Eliminar"/>
                                                        </StackPanel>
                                                    </Button>
                                                </Grid>

                                                <!-- Datos bÃ¡sicos del local - COMPLETO CON TODOS LOS CAMPOS -->
                                                <Grid ColumnDefinitions="*,12,*,12,*" RowDefinitions="Auto,12,Auto,12,Auto,12,Auto,12,Auto">
                                                    
                                                    <!-- FILA 1: CÃ³digo, Nombre, NÃºmero del Local -->
                                                    <StackPanel Grid.Column="0" Grid.Row="0" Spacing="4">
                                                        <TextBlock Text="CÃ³digo del Local *" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding CodigoLocal}" 
                                                                 Watermark="Ej: LOC001"
                                                                 FontSize="13"
                                                                 IsReadOnly="True"
                                                                 Background="#f0f0f0"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" Grid.Row="0" Spacing="4">
                                                        <TextBlock Text="Nombre del Local *" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding NombreLocal}" 
                                                                 Watermark="Ej: Sucursal Centro"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="4" Grid.Row="0" Spacing="4">
                                                        <TextBlock Text="NÃºmero del Local" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding LocalNumero}" 
                                                                 Watermark="Ej: 123"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                    <!-- FILA 2: DirecciÃ³n, Escalera, Piso -->
                                                    <StackPanel Grid.Column="0" Grid.Row="2" Spacing="4">
                                                        <TextBlock Text="DirecciÃ³n *" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding Direccion}" 
                                                                 Watermark="Ej: Av. Rivadavia 1234"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" Grid.Row="2" Spacing="4">
                                                        <TextBlock Text="Escalera" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding Escalera}" 
                                                                 Watermark="Ej: A"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="4" Grid.Row="2" Spacing="4">
                                                        <TextBlock Text="Piso" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding Piso}" 
                                                                 Watermark="Ej: 2Âº"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                    <!-- FILA 3: TelÃ©fono, Email -->
                                                    <StackPanel Grid.Column="0" Grid.Row="4" Spacing="4">
                                                        <TextBlock Text="TelÃ©fono del Local" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding Telefono}" 
                                                                 Watermark="+54 9 11 1234-5678"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" Grid.Row="4" Grid.ColumnSpan="3" Spacing="4">
                                                        <TextBlock Text="Email del Local" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding Email}" 
                                                                 Watermark="local@empresa.com"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                    <!-- FILA 4: MÃ¡ximo de Usuarios -->
                                                    <StackPanel Grid.Column="0" Grid.Row="6" Spacing="4">
                                                        <TextBlock Text="MÃ¡ximo de Usuarios" FontSize="12" Foreground="#555"/>
                                                        <NumericUpDown Value="{Binding NumeroUsuariosMax}"
                                                                       Minimum="1"
                                                                       Maximum="100"
                                                                       Increment="1"
                                                                       FormatString="0"
                                                                       FontSize="13"
                                                                       Width="150"
                                                                       HorizontalAlignment="Left"/>
                                                        <TextBlock Text="Cantidad mÃ¡xima de usuarios permitidos en este local" 
                                                                   FontSize="10" 
                                                                   Foreground="#999"
                                                                   TextWrapping="Wrap"/>
                                                    </StackPanel>

                                                    <!-- FILA 5: Observaciones (ocupa toda la fila) -->
                                                    <StackPanel Grid.Column="0" Grid.Row="8" Grid.ColumnSpan="5" Spacing="4">
                                                        <TextBlock Text="Observaciones del Local" FontSize="12" Foreground="#555"/>
                                                        <TextBox Text="{Binding Observaciones}" 
                                                                 Watermark="InformaciÃ³n adicional sobre este local..."
                                                                 AcceptsReturn="True"
                                                                 TextWrapping="Wrap"
                                                                 MinHeight="60"
                                                                 FontSize="13"/>
                                                    </StackPanel>

                                                </Grid>

                                                <!-- CheckBox de estado activo -->
                                                <CheckBox IsChecked="{Binding Activo}"
                                                          Margin="0,5,0,0">
                                                    <TextBlock Text="Local Activo" FontSize="13" FontWeight="Medium"/>
                                                </CheckBox>

                                                <Separator Background="#d0d0d0" Height="1" Margin="0,5"/>

                                                <!-- PERMISOS DE MÃ“DULOS PARA ESTE LOCAL -->
                                                <StackPanel Spacing="10">
                                                    <TextBlock Text="MÃ³dulos Habilitados para este Local" 
                                                               FontSize="14" 
                                                               FontWeight="SemiBold" 
                                                               Foreground="#0b5394"/>
                                                    
                                                    <TextBlock Text="Selecciona quÃ© mÃ³dulos estarÃ¡n disponibles para los usuarios de este local especÃ­fico" 
                                                               FontSize="11" 
                                                               Foreground="#777"
                                                               TextWrapping="Wrap"/>

                                                    <!-- Grid de checkboxes de mÃ³dulos -->
                                                    <Grid ColumnDefinitions="*,15,*" RowDefinitions="Auto,10,Auto">
                                                        
                                                        <!-- MÃ³dulo Divisas -->
                                                        <CheckBox Grid.Column="0" Grid.Row="0"
                                                                  IsChecked="{Binding ModuloDivisas}">
                                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                                <TextBlock Text="ðŸ’±" FontSize="16" VerticalAlignment="Center"/>
                                                                <StackPanel VerticalAlignment="Center">
                                                                    <TextBlock Text="MÃ³dulo Divisas" FontSize="13" FontWeight="Medium"/>
                                                                    <TextBlock Text="Cambio de monedas" FontSize="10" Foreground="#777"/>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </CheckBox>
                                                        
                                                        <!-- MÃ³dulo Pack Alimentos -->
                                                        <CheckBox Grid.Column="2" Grid.Row="0"
                                                                  IsChecked="{Binding ModuloPackAlimentos}">
                                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                                <TextBlock Text="ðŸ½ï¸" FontSize="16" VerticalAlignment="Center"/>
                                                                <StackPanel VerticalAlignment="Center">
                                                                    <TextBlock Text="Pack de Alimentos" FontSize="13" FontWeight="Medium"/>
                                                                    <TextBlock Text="Paquetes de comida" FontSize="10" Foreground="#777"/>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </CheckBox>
                                                        
                                                        <!-- MÃ³dulo Billetes de AviÃ³n -->
                                                        <CheckBox Grid.Column="0" Grid.Row="2"
                                                                  IsChecked="{Binding ModuloBilletesAvion}">
                                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                                <TextBlock Text="âœˆï¸" FontSize="16" VerticalAlignment="Center"/>
                                                                <StackPanel VerticalAlignment="Center">
                                                                    <TextBlock Text="Billetes de AviÃ³n" FontSize="13" FontWeight="Medium"/>
                                                                    <TextBlock Text="Venta de pasajes aÃ©reos" FontSize="10" Foreground="#777"/>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </CheckBox>
                                                        
                                                        <!-- MÃ³dulo Pack Viajes -->
                                                        <CheckBox Grid.Column="2" Grid.Row="2"
                                                                  IsChecked="{Binding ModuloPackViajes}">
                                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                                <TextBlock Text="ðŸ–ï¸" FontSize="16" VerticalAlignment="Center"/>
                                                                <StackPanel VerticalAlignment="Center">
                                                                    <TextBlock Text="Pack de Viajes" FontSize="13" FontWeight="Medium"/>
                                                                    <TextBlock Text="Paquetes turÃ­sticos" FontSize="10" Foreground="#777"/>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </CheckBox>
                                                        
                                                    </Grid>

                                                    <!-- Resumen de permisos -->
                                                    <Border Background="White"
                                                            BorderBrush="#0b5394"
                                                            BorderThickness="1"
                                                            CornerRadius="6"
                                                            Padding="10"
                                                            Margin="0,5,0,0">
                                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                                            <TextBlock Text="ðŸ“‹" FontSize="14" VerticalAlignment="Center"/>
                                                            <TextBlock Text="MÃ³dulos activos:" 
                                                                       FontSize="12" 
                                                                       FontWeight="Medium"
                                                                       Foreground="#555"
                                                                       VerticalAlignment="Center"/>
                                                            <TextBlock Text="{Binding PermisosResumen}" 
                                                                       FontSize="12" 
                                                                       Foreground="#0b5394"
                                                                       FontWeight="SemiBold"
                                                                       VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Border>

                                                </StackPanel>

                                            </StackPanel>
                                            
                                        </Border>
                                        
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                        </StackPanel>

                        <Separator Background="#e0e0e0" Height="1"/>

                        <!-- Botones de acciÃ³n del formulario -->
                        <Grid ColumnDefinitions="*,10,Auto,10,Auto">
                            
                            <Button Grid.Column="2"
                                    Command="{Binding CancelarFormularioCommand}"
                                    Background="#e0e0e0"
                                    Foreground="#555"
                                    Padding="20,10"
                                    CornerRadius="6"
                                    FontSize="14"
                                    FontWeight="Medium"
                                    Cursor="Hand"
                                    HorizontalAlignment="Right">
                                <TextBlock Text="Cancelar"/>
                            </Button>
                            
                            <Button Grid.Column="4"
                                    Command="{Binding GuardarComercioCommand}"
                                    Background="#0b5394"
                                    Foreground="White"
                                    Padding="20,10"
                                    CornerRadius="6"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Cursor="Hand"
                                    HorizontalAlignment="Right">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="ðŸ’¾" FontSize="14"/>
                                    <TextBlock Text="Guardar Comercio"/>
                                </StackPanel>
                            </Button>
                            
                        </Grid>

                    </StackPanel>
                    
                </Border>

                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- LISTA DE COMERCIOS -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <ItemsControl ItemsSource="{Binding Comercios}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="m:ComercioModel">
                            
                            <Border Background="White"
                                    CornerRadius="8"
                                    Padding="20"
                                    Margin="0,0,0,25"
                                    BoxShadow="0 4 12 0 #20000000"
                                    BorderBrush="#e0e0e0"
                                    BorderThickness="1">
                                
                                <Grid ColumnDefinitions="*,20,Auto">
                                    
                                    <!-- InformaciÃ³n del comercio -->
                                    <StackPanel Grid.Column="0" Spacing="12">
                                        
                                        <!-- Header con nombre y estado -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            
                                            <StackPanel Grid.Column="0" Spacing="4">
                                                <TextBlock Text="{Binding NombreComercio}" 
                                                           FontSize="18" 
                                                           FontWeight="Bold"
                                                           Foreground="#0b5394"/>
                                                <TextBlock Text="{Binding NombreSrl}" 
                                                           FontSize="13" 
                                                           Foreground="#777"/>
                                            </StackPanel>

                                            <Border Grid.Column="1"
                                                    Background="{Binding EstadoColor}"
                                                    CornerRadius="12"
                                                    Padding="12,4"
                                                    VerticalAlignment="Top">
                                                <TextBlock Text="{Binding EstadoTexto}" 
                                                           Foreground="White" 
                                                           FontSize="12"
                                                           FontWeight="Bold"/>
                                            </Border>
                                            
                                        </Grid>

                                        <!-- InformaciÃ³n de contacto -->
                                        <StackPanel Spacing="6">
                                            <TextBlock FontSize="13" Foreground="#555">
                                                <Run Text="ðŸ“"/>
                                                <Run Text="{Binding DireccionCentral}"/>
                                                <Run Text="â€¢"/>
                                                <Run Text="{Binding Pais}"/>
                                            </TextBlock>
                                            <TextBlock FontSize="13" Foreground="#555">
                                                <Run Text="ðŸ“§"/>
                                                <Run Text="{Binding MailContacto}"/>
                                                <Run Text="â€¢"/>
                                                <Run Text="ðŸ“ž"/>
                                                <Run Text="{Binding NumeroContacto}"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- EstadÃ­sticas de locales y usuarios -->
                                        <Grid ColumnDefinitions="Auto,20,Auto" Margin="0,5,0,0">
                                            <Border Grid.Column="0"
                                                    Background="#f8f9fa"
                                                    BorderBrush="#d0d0d0"
                                                    BorderThickness="1"
                                                    CornerRadius="6"
                                                    Padding="12,8">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <TextBlock Text="ðŸª" FontSize="14"/>
                                                    <TextBlock Text="{Binding CantidadLocales}" 
                                                               FontWeight="Bold" 
                                                               FontSize="14"/>
                                                    <TextBlock Text="Locales" FontSize="13" Foreground="#666"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <Border Grid.Column="2"
                                                    Background="#f8f9fa"
                                                    BorderBrush="#d0d0d0"
                                                    BorderThickness="1"
                                                    CornerRadius="6"
                                                    Padding="12,8">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <TextBlock Text="ðŸ‘¥" FontSize="14"/>
                                                    <TextBlock Text="{Binding TotalUsuarios}" 
                                                               FontWeight="Bold" 
                                                               FontSize="14"/>
                                                    <TextBlock Text="Usuarios" FontSize="13" Foreground="#666"/>
                                                </StackPanel>
                                            </Border>
                                        </Grid>

                                    </StackPanel>

                                    <!-- Botones de acciÃ³n -->
                                    <StackPanel Grid.Column="2" 
                                                Spacing="10"
                                                VerticalAlignment="Center">
                                        
                                        <!-- BotÃ³n Editar -->
                                        <Button Command="{Binding $parent[ItemsControl].((vm:ManageComerciosViewModel)DataContext).EditarComercioCommand}"
                                                CommandParameter="{Binding}"
                                                Background="#ffd966"
                                                Foreground="#0b5394"
                                                Padding="15,8"
                                                CornerRadius="6"
                                                FontSize="13"
                                                FontWeight="Medium"
                                                Cursor="Hand"
                                                Width="140"
                                                HorizontalContentAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <TextBlock Text="âœï¸" FontSize="14"/>
                                                <TextBlock Text="Editar"/>
                                            </StackPanel>
                                        </Button>
                                        
                                        <!-- BotÃ³n Cambiar Estado -->
                                        <Button Command="{Binding $parent[ItemsControl].((vm:ManageComerciosViewModel)DataContext).CambiarEstadoComercioCommand}"
                                                CommandParameter="{Binding}"
                                                Background="{Binding EstadoBotonColor}"
                                                Foreground="White"
                                                Padding="15,8"
                                                CornerRadius="6"
                                                FontSize="13"
                                                FontWeight="Medium"
                                                Cursor="Hand"
                                                Width="140"
                                                HorizontalContentAlignment="Center">
                                            <TextBlock Text="{Binding EstadoBotonTexto}"/>
                                        </Button>
                                        
                                        <!-- BotÃ³n Eliminar -->
                                        <Button Command="{Binding $parent[ItemsControl].((vm:ManageComerciosViewModel)DataContext).EliminarComercioCommand}"
                                                CommandParameter="{Binding}"
                                                Background="#6c757d"
                                                Foreground="White"
                                                Padding="15,8"
                                                CornerRadius="6"
                                                FontSize="13"
                                                FontWeight="Medium"
                                                Cursor="Hand"
                                                Width="140"
                                                HorizontalContentAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <TextBlock Text="ðŸ—‘ï¸" FontSize="14"/>
                                                <TextBlock Text="Eliminar"/>
                                            </StackPanel>
                                        </Button>
                                        
                                    </StackPanel>

                                </Grid>
                                
                            </Border>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Mensaje cuando no hay comercios -->
                <Border IsVisible="{Binding !Comercios.Count}"
                        Background="#f8f9fa"
                        BorderBrush="#d0d0d0"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="40"
                        HorizontalAlignment="Center">
                    <StackPanel Spacing="15" HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ“‹" 
                                   FontSize="48" 
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="No hay comercios registrados" 
                                   FontSize="16" 
                                   FontWeight="Medium"
                                   Foreground="#777"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Haz clic en 'Nuevo Comercio' para comenzar" 
                                   FontSize="13" 
                                   Foreground="#999"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

            </StackPanel>
            
        </ScrollViewer>
        
    </Grid>

</UserControl>
